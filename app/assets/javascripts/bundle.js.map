{"version":3,"sources":["webpack/bootstrap","./frontend/api_utils.js","./frontend/follow_toggle.js","./frontend/tweet_compose.js","./frontend/twitter.js","./frontend/users_search.js"],"names":[],"mappings":";QAAA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;;;;AClFA;AACA;AACA;AACA;AACA,yBAAyB,GAAG;AAC5B;AACA,KAAK;AACL,GAAG;;AAEH;AACA;AACA;AACA,qBAAqB,GAAG;AACxB;AACA,KAAK;AACL,GAAG;;AAEH;AACA;AACA;AACA;AACA,aAAa,gBAAgB;AAC7B;AACA,KAAK;AACL,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA,0B;;;;;;;;;;;ACpCA,iBAAiB,mBAAO,CAAC,+CAAgB;;AAEzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA,SAAS;AACT;AACA,KAAK;AACL;AACA;;AAEA,8B;;;;;;;;;;;AC3CA,iBAAiB,mBAAO,CAAC,+CAAgB;;AAEzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA,mBAAmB;AACnB,oBAAoB;AACpB,kBAAkB;AAClB,kBAAkB;AAClB;AACA;AACA,G;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA,SAAS;AACT,4BAA4B,6BAA6B;AACzD;;AAEA;AACA;AACA;AACA;AACA;AACA,I;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;;AAEA;AACA;AACA,0BAA0B,QAAQ,KAAK,cAAc;AACrD;AACA;AACA;;AAEA;;;AAGA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL,2BAA2B,UAAU;AACrC;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,4BAA4B,oBAAoB;AAChD;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,8B;;;;;;;;;;;AC/PA,qBAAqB,mBAAO,CAAC,uDAAoB;AACjD,oBAAoB,mBAAO,CAAC,qDAAmB;AAC/C,qBAAqB,mBAAO,CAAC,uDAAoB;;AAEjD;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA,GAAG;;AAEH;AACA;AACA,GAAG;AACH,CAAC,E;;;;;;;;;;;AChBD,iBAAiB,mBAAO,CAAC,+CAAgB;AACzC,qBAAqB,mBAAO,CAAC,uDAAoB;;AAEjD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO;;AAEP;AACA,0BAA0B,QAAQ,IAAI,cAAc;AACpD;;AAEA;;AAEA;AACA,KAAK;AACL;AACA;;AAEA,6B","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./frontend/twitter.js\");\n","const APIUtils = {\n  followUser: id => {\n    return $.ajax({\n          method: \"POST\",\n          url: `/users/${id}/follow`,\n          dataType: \"json\"\n    });\n  },\n\n  unfollowUser: id => {\n    return $.ajax({\n      method: \"DELETE\",\n      url: `/users/${id}/follow`,\n      dataType: \"json\"\n    });\n  },\n\n  searchUsers: queryVal => {\n    return $.ajax({\n      method: \"GET\",\n      url: `/users/search`,\n      data: {query: queryVal},\n      dataType: \"json\"\n    });\n  },\n\n  createTweet: formData => {\n    return $.ajax({\n      method: \"POST\",\n      url: \"/tweets\",\n      data: formData,\n      dataType: \"json\"\n    })\n  }\n}\n\nmodule.exports = APIUtils;","const APIUtils = require(\"./api_utils.js\");\n\nclass FollowToggle {\n  constructor($el, options) {\n    this.userId = $el.data(\"userId\") || options.userId;\n    this.followState = $el.data(\"initialFollowState\") || options.followState;\n    this.$followEl = $el;\n    this.render();\n    this.handleClick();\n  }\n\n  render() {\n    if (this.followState === \"followed\") {\n      this.$followEl.text(\"Unfollow\");\n    } else if (this.followState === \"unfollowed\") {\n      this.$followEl.text(\"Follow\");\n    }\n\n    this.$followEl.prop(\"disabled\", false);\n  }\n\n  handleClick() {\n    this.$followEl.on(\"click\", (e) => {\n      e.preventDefault();\n\n      //disable button until ajax response\n      this.$followEl.prop(\"disabled\", true);\n\n      if (this.followState === \"unfollowed\") {\n        APIUtils.followUser(this.userId).then(() => {\n          this.followState = \"followed\";\n          this.render();\n        });\n      } else if (this.followState === \"followed\") {\n        APIUtils.unfollowUser(this.userId).then(() => {\n          this.followState = \"unfollowed\";\n          this.render();\n        });\n      }\n    });\n  }\n}\n\nmodule.exports = FollowToggle;","const APIUtils = require(\"./api_utils.js\");\n\nclass TweetCompose {\n  constructor($formEl) {\n    this.$formEl = $formEl;\n    this.$suggestionList = $($formEl.find(\".suggested-users\")[0]);\n    this.submitOn = true;\n    this.handleSubmit();\n    this.handleInput();\n  }\n\n  // EVENTS\n\n  handleSubmit() {\n    this.$formEl.on(\"submit\", (e) => {\n      e.preventDefault();\n\n      this.$atResult.empty();\n      const formData = $(e.currentTarget).serializeJSON();\n      this.submit(formData);\n    });\n  }\n\n  handleInput() {\n    this.$formEl.on(\"input\", \".tweet-content\", (e) => {\n      let caretPos = this.getCaretCharacterOffsetWithin(e.currentTarget);\n      this.highlightAllMentions(e.currentTarget);\n      this.setCaretPosition(e.currentTarget, caretPos);\n      // const selectedMention = this.parseCurrentMention(value);\n      // this.searchForUsers(selectedMention);\n      // this.checkCharCount(value);\n    });\n  }\n\n  // PARSE INPUT\n  escape(s) {\n    let lookup = {\n        '&': \"&amp;\",\n        '\"': \"&quot;\",\n        '<': \"&lt;\",\n        '>': \"&gt;\"\n    };\n    return s.replace( /[&\"<>]/g, (c) => lookup[c] );\n  } \n\n  highlightAllMentions(targetElem) {\n    const $target = $(targetElem);\n    // regex\n    const at = /([\\s]|^)(\\@[0-9A-Za-z\\_]+)/g;\n    const highlighted = /\\<span class\\=\\\"highlight\\\"\\>([\\S]+)\\<\\/span\\>/g;\n    \n    // clear highlights\n    let html = $target.html();\n    html = html.replace(highlighted, \"$1\");\n    $target.html(html);\n\n    // highlight words begining with @\n    let text = this.escape($target.text());\n    html = text.replace(at, '$1<span class=\"highlight\">$2</span>');\n\n    $target.html(html);\n  }\n\n  getCaretCharacterOffsetWithin(element) {\n    let caretOffset = 0;\n    if (typeof window.getSelection != \"undefined\") {\n        let range = window.getSelection().getRangeAt(0);\n        let preCaretRange = range.cloneRange();\n        preCaretRange.selectNodeContents(element);\n        preCaretRange.setEnd(range.endContainer, range.endOffset);\n        caretOffset = preCaretRange.toString().length;\n    } else if (typeof document.selection != \"undefined\" && document.selection.type != \"Control\") {\n        let textRange = document.selection.createRange();\n        let preCaretTextRange = document.body.createTextRange();\n        preCaretTextRange.moveToElementText(element);\n        preCaretTextRange.setEndPoint(\"EndToEnd\", textRange);\n        caretOffset = preCaretTextRange.text.length;\n    }\n    return caretOffset;\n  }\n\n  createRange(elem, caretPos, range) {\n    console.log(elem);\n    console.log(caretPos);\n    console.log(range);\n    if (!range) {\n        range = document.createRange()\n        range.selectNode(elem);\n        range.setStart(elem, 0);\n    }\n\n    if (caretPos === 0) {\n        range.setEnd(elem, caretPos);\n    } else if (elem && caretPos > 0) {\n        if (elem.nodeType === elem.TEXT_NODE) {\n            if (elem.textContent.length < caretPos) {\n                caretPos -= elem.textContent.length;\n                console.log(\"text\");\n            } else {\n                 range.setEnd(elem, caretPos);\n                 caretPos = 0;\n                 console.log(\"text2\");\n            }\n        } else {\n            for (var lp = 0; lp < elem.childNodes.length; lp++) {\n                range = this.createRange(elem.childNodes[lp], caretPos, range);\n\n                if (caretPos === 0) {\n                   break;\n                }\n            }\n        }\n   } \n\n   return range;\n  }\n\n  setCaretPosition(elem, caretPos) {\n    if (caretPos >= 0) {\n        let selection = window.getSelection();\n\n        let range = this.createRange(elem, caretPos);\n\n        if (range) {\n            range.collapse(false);\n            selection.removeAllRanges();\n            selection.addRange(range);\n        }\n    }\n};\n\n\n  parseCurrentMention(content, selectedIdx) {\n    // get content before and after the selected position\n    console.log(selectedIdx);\n    const contentBeforeSelected = content.slice(0, selectedIdx);\n    const contentAfterSelected = content.slice(selectedIdx);\n\n    // get content between @ symbol and end of word\n    const toPrevAt = /(?:[\\s]|^)\\@([0-9A-Za-z\\_]+)$/g;\n    const toEnd = /^([a-zA-Z0-9\\_]+)/g;\n    const strAfterAt = toPrevAt.exec(contentBeforeSelected);\n    const strBeforeEnd = toEnd.exec(contentAfterSelected);\n    if (!strAfterAt) {\n      return null;\n    }\n\n    let selectedContent = strAfterAt[1];\n\n    if (strBeforeEnd) {\n      selectedContent = selectedContent.concat(strBeforeEnd[1]);\n    }\n\n    console.log(selectedContent);\n\n    return selectedContent;\n  }\n\n  // SEARCH SUGGESTIONS\n\n  searchForUsers(selectedMention) {\n    if (selectedMention) {\n      APIUtils.searchUsers(selectedMention).then((res) => {\n        this.handleSearchResult(selectedMention, res);\n      });\n    } else {\n      this.$suggestionList.empty();\n    }\n  }\n\n  handleSearchResult(selectedMention, res) {\n    this.$atResult.empty();\n    res.forEach((user) => {\n      this.renderSuggestedUser(user);\n      this.checkExactMatch(user, selectedMention);\n    });\n  }\n\n  // USER SUGGESTIONS\n\n  renderSuggestedUser(user) {\n    const $user = $(`<li>\n        <a href=\"/users/${user.id}\">@${user.username}</a>\n      </li>`);\n    this.$atResult.append($user);\n  }\n\n  // FIND ALL MENTIONED USERS\n\n  \n  // CHARACTERS LEFT\n\n  checkCharCount(content) {\n    let charsLeft = 150;\n    charsLeft -= content.length;\n\n    charsLeft < 0 ? this.disableSubmit() : this.enableSubmit();\n    this.renderCharsLeft(charsLeft);\n  }\n\n  renderCharsLeft(charsLeft) {\n    const $charsLeftEl = $(\".chars-left\");\n    \n    if (charsLeft < 0) {\n      $charsLeftEl.text(`You have exceeded max 150 characters!`);\n      $charsLeftEl.addClass(\"warning\");\n    } else {\n      $charsLeftEl.text(`${charsLeft} characters left`);\n      $charsLeftEl.removeClass(\"warning\");\n    }\n  }\n\n  // SUBMIT\n\n  disableSubmit() {\n    if (this.submitON) {\n      this.$formEl.off(\"submit\");\n      $(\".tweet-input_submit\").prop(\"disabled\", true);\n      this.submitON = false;\n    }\n  }\n\n  enableSubmit() {\n    if (!this.submitOn) {\n      this.handleSubmit();\n      $(\".tweet-input_submit\").prop(\"disabled\", false);\n      this.submitOn = true;\n    }\n  }\n\n  submit(formData) {\n\n    // disable all form inputs\n    $(\".tweet-input\").prop(\"disabled\", true);\n\n    APIUtils.createTweet(formData).then(this.handleSuccess.bind(this));\n  }\n\n  handleSuccess(res) {\n    this.renderTweet(res);\n    this.clearInput();\n    $(\".tweet-input\").prop(\"disabled\", false);\n  }\n\n  renderTweet(res) {\n    const $tweet = $(`<li>${JSON.stringify(res)}</li>`);\n    $(this.$formEl.data(\"feedId\")).prepend($tweet);\n  }\n\n  clearInput() {\n    $(\".tweet-input_content\").val('');\n    $(\".tweet-input_mentions > option\").prop(\"selected\", false);\n  }\n}\n\nmodule.exports = TweetCompose;","const FollowToggle = require(\"./follow_toggle.js\");\nconst UsersSearch = require(\"./users_search.js\");\nconst TweetCompose = require(\"./tweet_compose.js\");\n\n$(() => {\n  $(\".follow-toggle\").each((idx, el) => {\n    const followToggle = new FollowToggle($(el));\n  });\n\n  $(\"nav.users-search\").each((idx, el) => {\n    const usersSearch = new UsersSearch($(el));\n  })\n\n  $(\"form.tweet-compose\").each((idx, el) => {\n    const tweetCompose = new TweetCompose($(el));\n  })\n});","const APIUtils = require(\"./api_utils.js\");\nconst FollowToggle = require(\"./follow_toggle.js\");\n\nclass UsersSearch {\n  constructor($el) {\n    this.$searchEl = $el;\n    this.$input = $($el.find(\"input\")[0]);\n    this.$resultList = $($el.find(\"ul\")[0]);\n    this.handleInput();\n  }\n\n  handleInput() {\n    this.$input.on(\"input\", (e) => {\n      APIUtils.searchUsers($(e.currentTarget).val())\n        .then(this.renderResults.bind(this));\n    })\n  }\n\n  renderResults(res) {\n    this.$resultList.empty();\n    res.forEach((user) => {\n      const $followBtn = $('<button class=\"follow-toggle\"></button>');\n\n      const followToggle = new FollowToggle($followBtn, {\n        userId: user.id, \n        followState: (user.followed ? \"followed\" : \"unfollowed\")\n      });\n\n      const $user = $(`<li>\n        <a href=\"/users/${user.id}\">${user.username}</a>\n      </li>`);\n\n      $user.append($followBtn);\n\n      this.$resultList.append($user);\n    })\n  }\n}\n\nmodule.exports = UsersSearch;"],"sourceRoot":""}